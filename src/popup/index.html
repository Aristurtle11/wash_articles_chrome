<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <title>Wash Articles Preview</title>
    <style>
      body {
        margin: 0;
        font-family: Arial, sans-serif;
        padding: 16px;
        width: 360px;
        background: #f7f9fc;
        color: #1f2933;
      }
      h1 {
        margin: 0 0 12px;
        font-size: 16px;
        color: #1a73e8;
      }
      .section {
        margin-bottom: 12px;
        padding: 12px;
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(15,23,42,0.12);
      }
      .section h2 {
        margin: 0 0 8px;
        font-size: 14px;
        color: #0f172a;
      }
      ul {
        margin: 0;
        padding-left: 18px;
      }
      li {
        margin-bottom: 6px;
      }
      .placeholder {
        text-align: center;
        color: #6b7280;
      }
      button {
        border: none;
        border-radius: 6px;
        padding: 6px 10px;
        background: #1a73e8;
        color: #fff;
        cursor: pointer;
        font-size: 12px;
      }
      button.secondary {
        background: #e2e8f0;
        color: #1f2933;
      }
      button.danger {
        background: #dc2626;
        color: #fff;
      }
      .image-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(64px, 1fr));
        gap: 8px;
      }
      .image-grid img {
        width: 100%;
        height: 64px;
        object-fit: cover;
        border-radius: 6px;
        box-shadow: 0 1px 3px rgba(15, 23, 42, 0.16);
      }
      .image-grid .image-error {
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        background: #fee2e2;
        color: #b91c1c;
        border-radius: 6px;
        padding: 8px;
      }
      textarea {
        width: 100%;
        min-height: 140px;
        resize: vertical;
        padding: 10px;
        border-radius: 6px;
        border: 1px solid #cbd5f5;
        font-size: 13px;
        line-height: 1.5;
        background: #f8fafc;
        color: #1f2933;
      }
      textarea:focus {
        border-color: #1a73e8;
        outline: none;
        box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.18);
      }
      .translation-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 8px;
      }
      .translation-status {
        font-size: 12px;
        color: #475569;
      }
      .formatted-preview {
        border: 1px solid #e2e8f0;
        border-radius: 8px;
        padding: 12px;
        background: #fff;
        max-height: 280px;
        overflow-y: auto;
      }
      .formatted-preview h2,
      .formatted-preview h3,
      .formatted-preview h4 {
        margin: 12px 0 6px;
      }
      .formatted-preview p {
        margin: 8px 0;
        line-height: 1.6;
      }
      .formatted-preview figure {
        margin: 12px 0;
        text-align: center;
      }
      .formatted-preview img {
        max-width: 100%;
        border-radius: 6px;
      }
      .formatted-preview figcaption {
        font-size: 12px;
        color: #475569;
        margin-top: 4px;
      }
      .formatted-preview .credit {
        margin-left: 4px;
        color: #94a3b8;
        font-style: italic;
      }
      .history-list {
        list-style: none;
        padding: 0;
        margin: 0;
        display: flex;
        flex-direction: column;
        gap: 8px;
      }
      .history-item {
        border: 1px solid #e2e8f0;
        border-radius: 8px;
        padding: 8px;
        display: flex;
        flex-direction: column;
        gap: 6px;
      }
      .history-meta {
        font-size: 12px;
        color: #475569;
      }
      .history-actions {
        display: flex;
        gap: 6px;
        flex-wrap: wrap;
      }
    </style>
  </head>
  <body>
    <h1>Wash Articles</h1>
    <div class="section" id="operations-section">
      <h2>操作</h2>
      <div class="history-actions" style="justify-content:flex-start;">
        <button id="wash-btn">Wash</button>
        <button id="open-settings" class="secondary">配置</button>
      </div>
      <div id="wash-status" class="translation-status">等待开始</div>
    </div>
    <div class="section" id="source-section">
      <h2>来源链接</h2>
      <div id="source-url" class="placeholder">暂无数据</div>
      <div id="capture-time" class="history-meta"></div>
    </div>
    <div class="section" id="summary-section">
      <h2>内容概览</h2>
      <ul id="summary-list"></ul>
      <div id="summary-empty" class="placeholder">等待页面提取结果…</div>
    </div>
    <div class="section" id="images-section">
      <h2>已缓存图片</h2>
      <div id="images-grid" class="image-grid"></div>
      <div id="images-empty" class="placeholder">尚未缓存图片</div>
    </div>
    <div class="section" id="translation-section">
      <div class="translation-header">
        <h2>正文整理</h2>
        <span id="translation-status" class="translation-status">尚未开始</span>
      </div>
      <label style="display:flex;flex-direction:column;gap:4px;margin-bottom:8px;">
        <span style="font-size:12px;color:#475569;">推荐标题</span>
        <input id="generated-title" type="text" readonly placeholder="等待整理…" style="padding:8px;border-radius:6px;border:1px solid #cbd5f5;font-size:13px;background:#f8fafc;color:#1f2933;" />
        <span id="title-status" class="translation-status">尚未整理</span>
      </label>
      <textarea id="translation-text" readonly placeholder="整理后的正文将在此显示"></textarea>
    </div>
    <div class="section" id="formatted-section">
      <div class="translation-header">
        <h2>排版预览</h2>
        <span id="formatted-status" class="translation-status">等待正文整理完成</span>
      </div>
      <div id="formatted-preview" class="formatted-preview">暂无排版结果</div>
      <div class="history-actions" style="justify-content:flex-end;">
        <button id="download-markdown" class="secondary">下载 Markdown</button>
        <button id="download-html" class="secondary">下载 HTML</button>
        <button id="copy-markdown" class="secondary">复制 Markdown</button>
        <button id="copy-html">复制 HTML</button>
      </div>
    </div>
    <div class="section" id="wechat-section">
      <div class="translation-header">
        <h2>公众号草稿</h2>
        <span id="wechat-status" class="translation-status">等待正文整理完成</span>
      </div>
      <label>
        标题
        <input id="wechat-title" type="text" placeholder="文章标题" />
      </label>
      <label>
        摘要
        <textarea id="wechat-digest" rows="3" placeholder="摘要（可选，官方建议不超过120字）"></textarea>
      </label>
      <label>
        阅读原文链接
        <input id="wechat-source-url" type="url" placeholder="https://example.com/original" />
      </label>
      <label>
        封面 thumb_media_id（可选）
        <input id="wechat-thumb-media" type="text" placeholder="公众号素材库中的 media_id" />
      </label>
      <div class="history-actions" style="justify-content:flex-end;">
        <button id="wechat-create">生成公众号草稿</button>
        <button id="wechat-copy-payload" class="secondary">复制草稿 JSON</button>
      </div>
      <textarea id="wechat-draft-output" rows="6" readonly placeholder="草稿结构将在此显示"></textarea>
    </div>
    <div class="section" id="history-section">
      <h2>历史记录</h2>
      <ul id="history-list" class="history-list"></ul>
      <div id="history-empty" class="placeholder">暂无历史记录</div>
      <button id="history-clear" class="danger" style="margin-top:8px;">清空历史</button>
    </div>
    <script type="module" src="./popup.js"></script>
  </body>
</html>
